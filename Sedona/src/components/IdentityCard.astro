---
const { type, username, url } = Astro.props;

let displayData = {
    primaryStat: "0",
    label: "Loading",
    subStat: ""
};

try {
    if (type === 'github') {
        const response = await fetch(`https://api.github.com/users/${username}`);
        const data = await response.json();
        displayData = {
            primaryStat: data.public_repos || "0",
            label: "Repos",
            subStat: `Followers: ${data.followers || 0}`
        };
    } else if (type === 'leetcode') {
        // Using a reliable community GraphQL proxy for LeetCode
        const response = await fetch(`https://leetcode-stats-api.herokuapp.com/${username}`);
        const data = await response.json();
        displayData = {
            primaryStat: data.totalSolved || "0",
            label: "Solved",
            subStat: `Ranking: #${data.ranking?.toLocaleString() || 'N/A'}`,
            percentage: (data.totalSolved / data.totalQuestions * 100).toFixed(0) + '%'
        };
    }
} catch (e) {
    console.error(`Error fetching ${type} data:`, e);
}
---

<div class="relative w-full h-full group p-4">
    <div class="absolute inset-4 translate-y-3 translate-x-2 bg-[#38000A]/10 rounded-[2.5rem] -z-10 group-hover:translate-y-5 group-hover:translate-x-4 transition-all duration-500"></div>
    
    <div class="relative w-full h-full bg-gradient-to-br from-white via-white to-[#FFA896]/20 rounded-[2.5rem] border border-white/60 flex flex-col p-8 z-10 backdrop-blur-xl transition-all duration-500 group-hover:-translate-y-1">
        
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-[#CD1C18]">
                {type} Profile
            </h3>
            <div class="w-2 h-2 rounded-full bg-[#CD1C18] shadow-[0_0_10px_#CD1C18]"></div>
        </div>

        <div class="flex-1 flex flex-col justify-center">
            <div class="relative">
                <div class="absolute inset-0 bg-[#CD1C18]/20 blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                
                <div class="relative space-y-1">
                    <div class="flex items-baseline gap-2">
                        <span class="text-5xl font-black italic text-[#38000A] group-hover:text-[#CD1C18] transition-colors duration-500">
                            {displayData.primaryStat}
                        </span>
                        <span class="text-[10px] font-bold uppercase text-gray-400">
                            {displayData.label}
                        </span>
                    </div>
                    <div class="w-full h-[1px] bg-[#38000A]/5 my-4"></div>
                    
                    {type === 'leetcode' ? (
                        <div class="space-y-2">
                            <div class="flex justify-between items-end text-[9px] font-bold uppercase">
                                <span class="text-gray-400">Global Rank</span>
                                <span class="text-[#38000A]">{displayData.subStat.split(': ')[1]}</span>
                            </div>
                            <div class="w-full h-1.5 bg-gray-100 rounded-full overflow-hidden">
                                <div 
                                    class="h-full bg-[#CD1C18] rounded-full transition-all duration-1000" 
                                    style={`width: ${displayData.percentage || '0%'}`}
                                ></div>
                            </div>
                        </div>
                    ) : (
                        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-tighter">
                            {displayData.subStat}
                        </p>
                    )}
                </div>
            </div>
        </div>

        <div class="mt-6 pt-4 border-t border-[#38000A]/5">
            <a href={url} target="_blank" rel="noopener noreferrer" class="text-[10px] font-black uppercase tracking-widest text-[#CD1C18] flex items-center gap-2 group/link">
                View Profile
                <span class="group-hover/link:translate-x-1 transition-transform">â†’</span>
            </a>
        </div>
    </div>
</div>