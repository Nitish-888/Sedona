---
const { type, username, url } = Astro.props;

let displayData = {
    primaryStat: "0",
    label: "Loading",
    stats: { easy: 0, medium: 0, hard: 0 },
    subStat: ""
};

try {
    if (type === 'github') {
        const response = await fetch(`https://api.github.com/users/${username}`);
        if (response.ok) {
            const data = await response.json();
            displayData = {
                primaryStat: data.public_repos || "0",
                label: "Repos",
                stats: { easy: 0, medium: 0, hard: 0 },
                subStat: `Followers: ${data.followers || 0}`
            };
        }
    } else if (type === 'leetcode') {
        const response = await fetch(`https://leetcode-api-pied.vercel.app/user/${username}`, {
            signal: AbortSignal.timeout(5000) 
        });
        
        if (response.ok) {
            const data = await response.json();
            const acStats = data.submitStats.acSubmissionNum;
            
            displayData = {
                primaryStat: acStats.find(s => s.difficulty === "All")?.count.toString() || "0",
                label: "Solved",
                stats: {
                    easy: acStats.find(s => s.difficulty === "Easy")?.count || 0,
                    medium: acStats.find(s => s.difficulty === "Medium")?.count || 0,
                    hard: acStats.find(s => s.difficulty === "Hard")?.count || 0
                },
                subStat: ""
            };
        }
    }
} catch (e) {
    console.error(`Error fetching ${type} data:`, e);
    displayData.primaryStat = "!";
    displayData.label = "Offline";
}
---

<div class="relative w-full h-full group p-4">
    <div class="absolute inset-4 translate-y-3 translate-x-2 bg-[#38000A]/10 rounded-[2.5rem] -z-10 group-hover:translate-y-5 group-hover:translate-x-4 transition-all duration-500"></div>
    
    <div class="relative w-full h-full bg-gradient-to-br from-white via-white to-[#FFA896]/20 rounded-[2.5rem] border border-white/60 flex flex-col p-8 z-10 backdrop-blur-xl transition-all duration-500 group-hover:-translate-y-1">
        
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-[#CD1C18]">
                {type} Profile
            </h3>
            <div class="w-2 h-2 rounded-full bg-[#CD1C18] shadow-[0_0_10px_#CD1C18]"></div>
        </div>

        <div class="flex-1 flex flex-col justify-center">
            <div class="relative">
                <div class="absolute inset-0 bg-[#CD1C18]/20 blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="relative space-y-1">
                    <div class="flex items-baseline gap-2">
                        <span class="text-5xl font-black italic text-[#38000A] group-hover:text-[#CD1C18] transition-colors duration-500">
                           {displayData.primaryStat}
                        </span>
                        <span class="text-[10px] font-bold uppercase text-gray-400">
                            {displayData.label}
                        </span>
                    </div>
                    
                    <div class="w-full h-[1px] bg-[#38000A]/5 my-4"></div>
                    
                    {type === 'leetcode' ? (
                        <div class="grid grid-cols-3 gap-2 mt-4">
                            <div class="flex flex-col gap-1">
                                <div class="flex items-center gap-1.5">
                                    <div class="w-1.5 h-1.5 rounded-full bg-[#00AF91] shadow-[0_0_5px_#00AF91]"></div>
                                    <span class="text-[8px] font-black uppercase text-gray-400 tracking-tighter">Easy</span>
                                </div>
                                <span class="text-sm font-bold text-[#38000A] ml-3">{displayData.stats.easy}</span>
                            </div>
                            <div class="flex flex-col gap-1 border-x border-[#38000A]/5 px-2">
                                <div class="flex items-center gap-1.5">
                                    <div class="w-1.5 h-1.5 rounded-full bg-[#FFB800] shadow-[0_0_5px_#FFB800]"></div>
                                    <span class="text-[8px] font-black uppercase text-gray-400 tracking-tighter">Med</span>
                                </div>
                                <span class="text-sm font-bold text-[#38000A] ml-3">{displayData.stats.medium}</span>
                            </div>
                            <div class="flex flex-col gap-1 items-end">
                                <div class="flex items-center gap-1.5">
                                    <div class="w-1.5 h-1.5 rounded-full bg-[#FF2D55] shadow-[0_0_5px_#FF2D55]"></div>
                                    <span class="text-[8px] font-black uppercase text-gray-400 tracking-tighter">Hard</span>
                                </div>
                                <span class="text-sm font-bold text-[#38000A] mr-3">{displayData.stats.hard}</span>
                            </div>
                        </div>
                    ) : (
                        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-tighter">
                            {displayData.subStat}
                        </p>
                    )}
                </div>
            </div>
        </div>

        <div class="mt-6 pt-4 border-t border-[#38000A]/5">
            <a href={url} target="_blank" rel="noopener noreferrer" class="text-[10px] font-black uppercase tracking-widest text-[#CD1C18] flex items-center gap-2 group/link">
                View Profile
                <span class="group-hover/link:translate-x-1 transition-transform">â†’</span>
            </a>
        </div>
    </div>
</div>